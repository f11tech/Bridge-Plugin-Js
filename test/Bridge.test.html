<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>WebSocket Index Example</title>
        <script src="../dist/bridge.min.js"></script>
        <script src="../src/WebSocketManager.js"></script>
    </head>

    <body>
        <h1>WebSocket Index Example</h1>

        <!-- Buttons -->
        <button id="print-receipt-button">Print Receipt</button>
        <input type="text" id="messageA" placeholder="Message A">
        <input type="text" id="messageB" placeholder="Message A">
        <button id="send-message-button">Send</button>

        <script>
            // Create a new Index instance
            const bridge = new Bridge(51510);

            // Automatically connect to the WebSocket server on page load
            window.onload = () => {
                bridge.connect();
                console.log('WebSocket connection initialized.');
            };

            // Add event listener to the "Print Receipt" button
            const printReceiptButton = document.getElementById("print-receipt-button");
            printReceiptButton.addEventListener("click", async () => {
                try {
                    const response = await fetch("formato/receipt.html");
                    if (!response.ok) {
                        console.error("Failed to load receipt HTML file:", response.statusText);
                        return;
                    }
                    const receiptHtml = await response.text();
                    const configs = ["Cliente"];
                    bridge.print(configs, receiptHtml);
                    console.log("Print request sent.");
                } catch (error) {
                    console.error("Error printing receipt:", error);
                }
            });

            const sendMessageButton = document.getElementById("send-message-button");
            sendMessageButton.addEventListener("click", async () => {
                const messageA = document.getElementById("messageA").value;
                const messageB = document.getElementById("messageB").value;

                try {
                    bridge.sendToDisplay(messageA, messageB);
                    console.log("Send message:", messageA, messageB);
                } catch (error) {
                    console.error("Error sending message:", error);
                }
            });
        </script>
    </body>
</html>
